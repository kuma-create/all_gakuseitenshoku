// settings.gradle — Minimal & Stable: React Native settings plugin ONLY
// （Expo の設定プラグイン/スクリプトは一旦すべて外す）

import org.gradle.api.GradleException

pluginManagement {
  repositories {
    gradlePluginPortal()
    google()
    mavenCentral()
  }

  // apps/mobile を起点に Node 解決（pnpm/monorepo 対応）
  def appDir = rootDir.getParentFile()

  // Resolve @react-native/gradle-plugin via Node and include as build
  def rnGradlePluginDir = new File(
    providers.exec {
      workingDir(rootDir)
      commandLine(
        "node", "--print",
        "require.resolve('@react-native/gradle-plugin/package.json', { paths: ['" + appDir.absolutePath.replace('\\', '\\\\') + "'] })"
      )
    }.standardOutput.asText.get().trim()
  ).getParentFile()
  if (!rnGradlePluginDir.exists()) {
    throw new GradleException("@react-native/gradle-plugin not found. Run in apps/mobile: pnpm add -D @react-native/gradle-plugin@0.79.5")
  }
  includeBuild(rnGradlePluginDir.absolutePath)
}

plugins {
  id("com.facebook.react.settings")
}

extensions.configure(com.facebook.react.ReactSettingsExtension){ ex ->
  ex.autolinkLibrariesFromCommand()
}

rootProject.name = "android"
include(":app")